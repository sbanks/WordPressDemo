/*
Holder.js - client side image placeholders
Â© 2012-2014 Ivan Malopinsky - http://imsky.co
*/
!function(a,b){function h(a,b,c,d){var e=i(c.substr(c.lastIndexOf(a.domain)),a);e&&j(null,d,e,b)}function i(a,b){for(var c={theme:x(g.settings.themes.gray,null),stylesheets:b.stylesheets,holderURL:[]},d=!1,e=String.fromCharCode(11),f=a.replace(/([^\\])\//g,"$1"+e).split(e),h=/%[0-9a-f]{2}/gi,i=f.length,j=0;i>j;j++){var k=f[j];if(k.match(h))try{k=decodeURIComponent(k)}catch(l){k=f[j]}var m=!1;if(g.flags.dimensions.match(k))d=!0,c.dimensions=g.flags.dimensions.output(k),m=!0;else if(g.flags.fluid.match(k))d=!0,c.dimensions=g.flags.fluid.output(k),c.fluid=!0,m=!0;else if(g.flags.textmode.match(k))c.textmode=g.flags.textmode.output(k),m=!0;else if(g.flags.colors.match(k)){var n=g.flags.colors.output(k);c.theme=x(c.theme,n),m=!0}else if(b.themes[k])b.themes.hasOwnProperty(k)&&(c.theme=x(b.themes[k],null)),m=!0;else if(g.flags.font.match(k))c.font=g.flags.font.output(k),m=!0;else if(g.flags.auto.match(k))c.auto=!0,m=!0;else if(g.flags.text.match(k))c.text=g.flags.text.output(k),m=!0;else if(g.flags.random.match(k)){null==g.vars.cache.themeKeys&&(g.vars.cache.themeKeys=Object.keys(b.themes));var o=g.vars.cache.themeKeys[0|Math.random()*g.vars.cache.themeKeys.length];c.theme=x(b.themes[o],null),m=!0}m&&c.holderURL.push(k)}return c.holderURL.unshift(b.domain),c.holderURL=c.holderURL.join("/"),d?c:!1}function j(a,b,c,d){var e=c.dimensions,f=c.theme,h=e.width+"x"+e.height;if(a=null==a?c.fluid?"fluid":"image":a,null!=c.text&&(f.text=c.text,"object"===b.nodeName.toLowerCase())){for(var i=f.text.split("\\n"),j=0;j<i.length;j++)i[j]=D(i[j]);f.text=i.join("\\n")}var l=c.holderURL,m=x(d,null);c.font&&(f.font=c.font,!m.noFontFallback&&"img"===b.nodeName.toLowerCase()&&g.setup.supportsCanvas&&"svg"===m.renderer&&(m=x(m,{renderer:"canvas"}))),c.font&&"canvas"==m.renderer&&(m.reRender=!0),"background"==a?null==b.getAttribute("data-background-src")&&u(b,{"data-background-src":l}):u(b,{"data-src":l}),c.theme=f,b.holderData={flags:c,renderSettings:m},("image"==a||"fluid"==a)&&u(b,{alt:f.text?(f.text.length>16?f.text.substring(0,16)+"\u2026":f.text)+" ["+h+"]":h}),"image"==a?("html"!=m.renderer&&c.auto||(b.style.width=e.width+"px",b.style.height=e.height+"px"),"html"==m.renderer?b.style.backgroundColor=f.background:(k(a,{dimensions:e,theme:f,flags:c},b,m),c.textmode&&"exact"==c.textmode&&(g.vars.resizableImages.push(b),n(b)))):"background"==a&&"html"!=m.renderer?k(a,{dimensions:e,theme:f,flags:c},b,m):"fluid"==a&&("%"==e.height.slice(-1)?b.style.height=e.height:null!=c.auto&&c.auto||(b.style.height=e.height+"px"),"%"==e.width.slice(-1)?b.style.width=e.width:null!=c.auto&&c.auto||(b.style.width=e.width+"px"),("inline"==b.style.display||""===b.style.display||"none"==b.style.display)&&(b.style.display="block"),p(b),"html"==m.renderer?b.style.backgroundColor=f.background:(g.vars.resizableImages.push(b),n(b)))}function k(a,b,c,d){function j(){var a=null;switch(d.renderer){case"canvas":a=r(h);break;case"svg":a=s(h,d);break;default:throw"Holder: invalid renderer: "+d.renderer}return a}var e=null;switch(d.renderer){case"svg":if(!g.setup.supportsSVG)return;break;case"canvas":if(!g.setup.supportsCanvas)return;break;default:return}var f={width:b.dimensions.width,height:b.dimensions.height,theme:b.theme,flags:b.flags},h=l(f);if({text:f.text,width:f.width,height:f.height,textHeight:f.font.size,font:f.font.family,fontWeight:f.font.weight,template:f.theme},e=j(),null==e)throw"Holder: couldn't render placeholder";"background"==a?(c.style.backgroundImage="url("+e+")",c.style.backgroundSize=f.width+"px "+f.height+"px"):("img"===c.nodeName.toLowerCase()?u(c,{src:e}):"object"===c.nodeName.toLowerCase()&&(u(c,{data:e}),u(c,{type:"image/svg+xml"})),d.reRender&&setTimeout(function(){var a=j();if(null==a)throw"Holder: couldn't render placeholder";"img"===c.nodeName.toLowerCase()?u(c,{src:a}):"object"===c.nodeName.toLowerCase()&&(u(c,{data:a}),u(c,{type:"image/svg+xml"}))},100)),u(c,{"data-holder-rendered":!0})}function l(a){function j(a,b,c,d){b.width=c,b.height=d,a.width=Math.max(a.width,b.width),a.height+=b.height,a.add(b)}switch(a.font={family:a.theme.font?a.theme.font:"Arial, Helvetica, Open Sans, sans-serif",size:m(a.width,a.height,a.theme.size?a.theme.size:g.defaults.size),units:a.theme.units?a.theme.units:g.defaults.units,weight:a.theme.fontweight?a.theme.fontweight:"bold"},a.text=a.theme.text?a.theme.text:Math.floor(a.width)+"x"+Math.floor(a.height),a.flags.textmode){case"literal":a.text=a.flags.dimensions.width+"x"+a.flags.dimensions.height;break;case"exact":if(!a.flags.exactDimensions)break;a.text=Math.floor(a.flags.exactDimensions.width)+"x"+Math.floor(a.flags.exactDimensions.height)}var b=new F({width:a.width,height:a.height}),c=b.Shape,d=new c.Rect("holderBg",{fill:a.theme.background});d.resize(a.width,a.height),b.root.add(d);var e=new c.Group("holderTextGroup",{text:a.text,align:"center",font:a.font,fill:a.theme.foreground});e.moveTo(null,null,1),b.root.add(e);var f=e.textPositionData=q(b);if(!f)throw"Holder: staging fallback not supported yet.";e.properties.leading=f.boundingBox.height;var h=null,i=null;if(f.lineCount>1){var k=0,l=0,n=a.width*g.setup.lineWrapRatio,o=0;i=new c.Group("line"+o);for(var p=0;p<f.words.length;p++){var r=f.words[p];h=new c.Text(r.text);var s="\\n"==r.text;(k+r.width>=n||s===!0)&&(j(e,i,k,e.properties.leading),k=0,l+=e.properties.leading,o+=1,i=new c.Group("line"+o),i.y=l),s!==!0&&(h.moveTo(k,0),k+=f.spaceWidth+r.width,i.add(h))}j(e,i,k,e.properties.leading);for(var t in e.children)i=e.children[t],i.moveTo((e.width-i.width)/2,null,null);e.moveTo((a.width-e.width)/2,(a.height-e.height)/2,null),(a.height-e.height)/2<0&&e.moveTo(null,0,null)}else h=new c.Text(a.text),i=new c.Group("line0"),i.add(h),e.add(i),e.moveTo((a.width-f.boundingBox.width)/2,(a.height-f.boundingBox.height)/2,null);return b}function m(a,b,c){b=parseInt(b,10),a=parseInt(a,10);var d=Math.max(b,a),e=Math.min(b,a),f=g.defaults.scale,h=Math.min(.75*e,.75*d*f);return Math.round(Math.max(c,h))}function n(a){var b;b=null==a||null==a.nodeType?g.vars.resizableImages:[a];for(var c in b)if(b.hasOwnProperty(c)){var d=b[c];if(d.holderData){var e=d.holderData.flags,h=o(d,f.invisibleErrorFn(n));if(h){if(e.fluid&&e.auto){var i=d.holderData.fluidConfig;switch(i.mode){case"width":h.height=h.width/i.ratio;break;case"height":h.width=h.height*i.ratio}}var j={dimensions:h,theme:e.theme,flags:e};e.textmode&&"exact"==e.textmode&&(e.exactDimensions=h,j.dimensions=e.dimensions),k("image",j,d,d.holderData.renderSettings)}}}}function o(a,b){var c={height:a.clientHeight,width:a.clientWidth};return c.height||c.width?(a.removeAttribute("data-holder-invisible"),c):(u(a,{"data-holder-invisible":!0}),b.call(this,a),void 0)}function p(a){if(a.holderData){var b=o(a,f.invisibleErrorFn(p));if(b){var c=a.holderData.flags,d={fluidHeight:"%"==c.dimensions.height.slice(-1),fluidWidth:"%"==c.dimensions.width.slice(-1),mode:null,initialDimensions:b};d.fluidWidth&&!d.fluidHeight?(d.mode="width",d.ratio=d.initialDimensions.width/parseFloat(c.dimensions.height)):!d.fluidWidth&&d.fluidHeight&&(d.mode="height",d.ratio=parseFloat(c.dimensions.width)/d.initialDimensions.height),a.holderData.fluidConfig=d}}}function t(a,b){return null==b?e.createElement(a):e.createElementNS(b,a)}function u(a,b){for(var c in b)a.setAttribute(c,b[c])}function v(a,b,c){if(null==a){a=t("svg",d);var e=t("defs",d);a.appendChild(e)}return a.webkitMatchesSelector&&a.setAttribute("xmlns",d),u(a,{width:b,height:c,viewBox:"0 0 "+b+" "+c,preserveAspectRatio:"none"}),a}function w(a,c){if(b.XMLSerializer){var d=new XMLSerializer,e="",f=c.stylesheets;if(a.querySelector("defs"),c.svgXMLStylesheet){for(var h=(new DOMParser).parseFromString("<xml />","application/xml"),i=f.length-1;i>=0;i--){var j=h.createProcessingInstruction("xml-stylesheet",'href="'+f[i]+'" rel="stylesheet"');h.insertBefore(j,h.firstChild)}var k=h.createProcessingInstruction("xml",'version="1.0" encoding="UTF-8" standalone="yes"');h.insertBefore(k,h.firstChild),h.removeChild(h.documentElement),e=d.serializeToString(h)}var l=d.serializeToString(a);return l=l.replace(/\&amp;(\#[0-9]{2,}\;)/g,"&$1"),e+l}}function x(a,b){var c={};for(var d in a)a.hasOwnProperty(d)&&(c[d]=a[d]);if(null!=b)for(var e in b)b.hasOwnProperty(e)&&(c[e]=b[e]);return c}function y(a){var b=[];for(var c in a)a.hasOwnProperty(c)&&b.push(c+":"+a[c]);return b.join(";")}function z(a){g.vars.debounceTimer||a.call(this),g.vars.debounceTimer&&clearTimeout(g.vars.debounceTimer),g.vars.debounceTimer=setTimeout(function(){g.vars.debounceTimer=null,a.call(this)},g.setup.debounce)}function A(){z(function(){n(null)})}function B(a){var c=null;return"string"==typeof a?c=e.querySelectorAll(a):b.NodeList&&a instanceof b.NodeList?c=a:b.Node&&a instanceof b.Node?c=[a]:b.HTMLCollection&&a instanceof b.HTMLCollection?c=a:null===a&&(c=[]),c}function C(a,b){var c=new Image;c.onerror=function(){b.call(this,!1)},c.onload=function(){b.call(this,!0)},c.src=a}function D(a){for(var b=[],c=0,d=a.length-1;d>=0;d--)c=a[d].charCodeAt(),c>128?b.unshift(["&#",c,";"].join("")):b.unshift(a[d]);return b.join("")}function E(a){return a.replace(/&#(\d+);/g,function(a,b){return String.fromCharCode(b)})}var d="http://www.w3.org/2000/svg",e=b.document,f={addTheme:function(a,b){return null!=a&&null!=b&&(g.settings.themes[a]=b),delete g.vars.cache.themeKeys,this},addImage:function(a,b){var c=e.querySelectorAll(b);if(c.length)for(var d=0,f=c.length;f>d;d++){var g=t("img");u(g,{"data-src":a}),c[d].appendChild(g)}return this},run:function(a){a=a||{};var c={};g.vars.preempted=!0;var d=x(g.settings,a);c.renderer=d.renderer?d.renderer:g.setup.renderer,-1===g.setup.renderers.join(",").indexOf(c.renderer)&&(c.renderer=g.setup.supportsSVG?"svg":g.setup.supportsCanvas?"canvas":"html"),d.use_canvas?c.renderer="canvas":d.use_svg&&(c.renderer="svg");var e=B(d.images),f=B(d.bgnodes),k=B(d.stylenodes),l=B(d.objects);c.stylesheets=[],c.svgXMLStylesheet=!0,c.noFontFallback=d.noFontFallback?d.noFontFallback:!1;for(var m=0;m<k.length;m++){var n=k[m];if(n.attributes.rel&&n.attributes.href&&"stylesheet"==n.attributes.rel.value){var o=n.attributes.href.value,p=t("a");p.href=o;var q=p.protocol+"//"+p.host+p.pathname+p.search;c.stylesheets.push(q)}}for(m=0;m<f.length;m++){var r=b.getComputedStyle(f[m],null).getPropertyValue("background-image"),s=f[m].getAttribute("data-background-src"),u=null;u=null==s?r:s;var v=null,w="?"+d.domain+"/";if(0===u.indexOf(w))v=u.slice(1);else if(-1!=u.indexOf(w)){var y=u.substr(u.indexOf(w)).slice(1),z=y.match(/([^\"]*)"?\)/);null!=z&&(v=z[1])}if(null!=v){var A=i(v,d);A&&j("background",f[m],A,c)}}for(m=0;m<l.length;m++){var D=l[m],E={};try{E.data=D.getAttribute("data"),E.dataSrc=D.getAttribute("data-src")}catch(F){}var G=null!=E.data&&0===E.data.indexOf(d.domain),H=null!=E.dataSrc&&0===E.dataSrc.indexOf(d.domain);G?h(d,c,E.data,D):H&&h(d,c,E.dataSrc,D)}for(m=0;m<e.length;m++){var I=e[m],J={};try{J.src=I.getAttribute("src"),J.dataSrc=I.getAttribute("data-src"),J.rendered=I.getAttribute("data-holder-rendered")}catch(F){}var K=null!=J.src,L=null!=J.dataSrc&&0===J.dataSrc.indexOf(d.domain),M=null!=J.rendered&&"true"==J.rendered;K?0===J.src.indexOf(d.domain)?h(d,c,J.src,I):L&&(M?h(d,c,J.dataSrc,I):function(a,b,c,d,e){C(a,function(a){a||h(b,c,d,e)})}(J.src,d,c,J.dataSrc,I)):L&&h(d,c,J.dataSrc,I)}return this},invisibleErrorFn:function(){return function(a){if(a.hasAttribute("data-holder-invisible"))throw"Holder: invisible placeholder"}}};f.add_theme=f.addTheme,f.add_image=f.addImage,f.invisible_error_fn=f.invisibleErrorFn;var g={settings:{domain:"holder.js",images:"img",objects:"object",bgnodes:"body .holderjs",stylenodes:"head link.holderjs",stylesheets:[],themes:{gray:{background:"#EEEEEE",foreground:"#AAAAAA"},social:{background:"#3a5a97",foreground:"#FFFFFF"},industrial:{background:"#434A52",foreground:"#C2F200"},sky:{background:"#0D8FDB",foreground:"#FFFFFF"},vine:{background:"#39DBAC",foreground:"#1E292C"},lava:{background:"#F8591A",foreground:"#1C2846"}}},defaults:{size:10,units:"pt",scale:1/16},flags:{dimensions:{regex:/^(\d+)x(\d+)$/,output:function(a){var b=this.regex.exec(a);return{width:+b[1],height:+b[2]}}},fluid:{regex:/^([0-9]+%?)x([0-9]+%?)$/,output:function(a){var b=this.regex.exec(a);return{width:b[1],height:b[2]}}},colors:{regex:/(?:#|\^)([0-9a-f]{3,})\:(?:#|\^)([0-9a-f]{3,})/i,output:function(a){var b=this.regex.exec(a);return{foreground:"#"+b[2],background:"#"+b[1]}}},text:{regex:/text\:(.*)/,output:function(a){return this.regex.exec(a)[1].replace("\\/","/")}},font:{regex:/font\:(.*)/,output:function(a){return this.regex.exec(a)[1]}},auto:{regex:/^auto$/},textmode:{regex:/textmode\:(.*)/,output:function(a){return this.regex.exec(a)[1]}},random:{regex:/^random$/}}},q=function(){var a=null,b=null,c=null;return function(f){var h=f.root;if(g.setup.supportsSVG){var i=!1,j=function(a){return e.createTextNode(a)};null==a&&(i=!0),a=v(a,h.properties.width,h.properties.height),i&&(b=t("text",d),c=j(null),u(b,{x:0}),b.appendChild(c),a.appendChild(b),e.body.appendChild(a),a.style.visibility="hidden",a.style.position="absolute",a.style.top="-100%",a.style.left="-100%");var k=h.children.holderTextGroup,l=k.properties;u(b,{y:l.font.size,style:y({"font-weight":l.font.weight,"font-size":l.font.size+l.font.units,"font-family":l.font.family,"dominant-baseline":"middle"})}),c.nodeValue=l.text;var m=b.getBBox(),n=Math.ceil(m.width/(h.properties.width*g.setup.lineWrapRatio)),o=l.text.split(" "),p=l.text.match(/\\n/g);n+=null==p?0:p.length,c.nodeValue=l.text.replace(/[ ]+/g,"");var q=b.getComputedTextLength(),r=m.width-q,s=Math.round(r/Math.max(1,o.length-1)),w=[];if(n>1){c.nodeValue="";for(var x=0;x<o.length;x++)if(0!==o[x].length){c.nodeValue=E(o[x]);var z=b.getBBox();w.push({text:o[x],width:z.width})}}return{spaceWidth:s,lineCount:n,boundingBox:m,words:w}}return!1}}(),r=function(){var a=t("canvas"),b=null;return function(c){null==b&&(b=a.getContext("2d"));var d=c.root;a.width=g.dpr(d.properties.width),a.height=g.dpr(d.properties.height),b.textBaseline="middle",b.fillStyle=d.children.holderBg.properties.fill,b.fillRect(0,0,g.dpr(d.children.holderBg.width),g.dpr(d.children.holderBg.height));var e=d.children.holderTextGroup;e.properties,b.font=e.properties.font.weight+" "+g.dpr(e.properties.font.size)+e.properties.font.units+" "+e.properties.font.family+", monospace",b.fillStyle=e.properties.fill;for(var h in e.children){var i=e.children[h];for(var j in i.children){var k=i.children[j],l=g.dpr(e.x+i.x+k.x),m=g.dpr(e.y+i.y+k.y+e.properties.leading/2);b.fillText(k.properties.text,l,m)}}return a.toDataURL("image/png")}}(),s=function(){if(b.XMLSerializer){var a=v(null,0,0),c=t("rect",d);return a.appendChild(c),function(b,f){var g=b.root;v(a,g.properties.width,g.properties.height);for(var h=a.querySelectorAll("g"),i=0;i<h.length;i++)h[i].parentNode.removeChild(h[i]);u(c,{width:g.children.holderBg.width,height:g.children.holderBg.height,fill:g.children.holderBg.properties.fill});var j=g.children.holderTextGroup,k=j.properties,l=t("g",d);a.appendChild(l);for(var m in j.children){var n=j.children[m];for(var o in n.children){var p=n.children[o],q=j.x+n.x+p.x,r=j.y+n.y+p.y+j.properties.leading/2,s=t("text",d),x=e.createTextNode(null);u(s,{x:q,y:r,style:y({fill:k.fill,"font-weight":k.font.weight,"font-family":k.font.family+", monospace","font-size":k.font.size+k.font.units,"dominant-baseline":"central"})}),x.nodeValue=p.properties.text,s.appendChild(x),l.appendChild(s)}}var z="data:image/svg+xml;base64,"+btoa(unescape(encodeURIComponent(w(a,f))));return z}}}(),F=function(a){function c(a,b){for(var c in b)a[c]=b[c];return a}var b=1,d=augment.defclass({constructor:function(a){b++,this.parent=null,this.children={},this.id=b,this.name="n"+b,null!=a&&(this.name=a),this.x=0,this.y=0,this.z=0,this.width=0,this.height=0},resize:function(a,b){null!=a&&(this.width=a),null!=b&&(this.height=b)},moveTo:function(a,b,c){this.x=null!=a?a:this.x,this.y=null!=b?b:this.y,this.z=null!=c?c:this.z},add:function(a){var b=a.name;if(null!=this.children[b])throw"SceneGraph: child with that name already exists: "+b;this.children[b]=a,a.parent=this}}),e=augment(d,function(b){this.constructor=function(){b.constructor.call(this,"root"),this.properties=a}}),f=augment(d,function(a){function b(b,d){if(a.constructor.call(this,b),this.properties={fill:"#000"},null!=d)c(this.properties,d);else if(null!=b&&"string"!=typeof b)throw"SceneGraph: invalid node name"}this.Group=augment.extend(this,{constructor:b,type:"group"}),this.Rect=augment.extend(this,{constructor:b,type:"rect"}),this.Text=augment.extend(this,{constructor:function(a){b.call(this),this.properties.text=a},type:"text"})}),g=new e;return this.Shape=f,this.root=g,this};for(var G in g.flags)g.flags.hasOwnProperty(G)&&(g.flags[G].match=function(a){return a.match(this.regex)});g.setup={renderer:"html",debounce:100,ratio:1,supportsCanvas:!1,supportsSVG:!1,lineWrapRatio:.9,renderers:["html","canvas","svg"]},g.dpr=function(a){return a*g.setup.ratio},g.vars={preempted:!1,resizableImages:[],debounceTimer:null,cache:{}},function(){var a=1,c=1,f=t("canvas"),h=null;f.getContext&&-1!=f.toDataURL("image/png").indexOf("data:image/png")&&(g.setup.renderer="canvas",h=f.getContext("2d"),g.setup.supportsCanvas=!0),g.setup.supportsCanvas&&(a=b.devicePixelRatio||1,c=h.webkitBackingStorePixelRatio||h.mozBackingStorePixelRatio||h.msBackingStorePixelRatio||h.oBackingStorePixelRatio||h.backingStorePixelRatio||1),g.setup.ratio=a/c,e.createElementNS&&e.createElementNS(d,"svg").createSVGRect&&(g.setup.renderer="svg",g.setup.supportsSVG=!0)}(),a(f,"Holder",b),b.onDomReady&&b.onDomReady(function(){g.vars.preempted||f.run(),b.addEventListener?(b.addEventListener("resize",A,!1),b.addEventListener("orientationchange",A,!1)):b.attachEvent("onresize",A),"object"==typeof b.Turbolinks&&b.document.addEventListener("page:change",function(){f.run()})})}(function(a,b,c){var d="function"==typeof define&&define.amd;d?define(a):c[b]=a},this);